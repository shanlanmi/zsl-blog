----
title: Vim中的正则表达式小结
date: 2016-07-21 18:29:45
tags:
- Editor
----
## 替换模式

### 基本用法

- range
  - 默认为当前行
  - `1,10s/`：第1行到第10行
  - `10s/`：第10行
  - `%s/`：所有行
  - `10,$s/`: 第10行至最后一行
  - `'&#60;,'&#62;`：选定行范围

- flag
  - `c`：每次替换询问
  - `g`：替换所有（默认替换第一个匹配字符串）
  - `i`：忽略大小写
  - `e`：不显示错误

- 询问选项
  - y：Yes
  - n：No
  - a：All
  - q：Quit,give up this one
  - l：Quit after replace this one
  - CTRL-E：Scroll up
  - CTRL-Y：Scroll down

- `\m` magic(default): 除了`^.*$`之外所有的字符都需要加反斜杠
- `\M` nomagic: 除了`^$`之外所有的字符都需要加反斜杠
- `\v` very magic: 任何字符都不需要加反斜杠
- `\V` very nomagic: 任何字体都需要加反斜杠

[字符参考](http://vimdoc.sourceforge.net/htmldoc/pattern.html#/)

### 变量替换

**几个参数**

参数|代表
---|---
\r |代表&#60;Return&#62;
\t |代表&#60;Tab&#62;
\1 | 代表第一个包裹变量
\2 |代表第二个包裹变量，以此类推
\0 or &|代表匹配字符串
~ |代表上一次替换的字符串
\={Vim script}|脚本运行结果作为变量，可以是寄存器内的内容`@{reg}`


- 用`\(`和`\)`来包裹变量,用`\1`,`\2`来替代变量。
  1. 例子一：
    原字符串：`abc abd acd afg`
    在所有`a`开头的单词后加`,`可以用：`:s/\(a\w*\) /\1, /g`
  1. 例子二：
    原字符串：`aaa bbb`
    将两个单词互换位置：`:s/\(\w*\) \(\w*\)/\2 \1/g`
- 用`&`代替匹配字符串
  原字符串：`aaa ccc`
  正则表达式：`:s/aaa/& bbb/g`
  替换结果：`aaa bbb ccc`
- 用`~`代替上一次替换字符串
  原字符串：`aaa bbb`
  第一次正则表达式：`:s/aaa/ccc/g`
  第二次正则表达式：`:s/bbb/~/g`
  替换结果：`ccc ccc`
  用`:~`可以重复上一次正则表达式的命令
  
  

## 匹配行处理模式


- 模式参式
  - g：匹配行处理
  - g!: 非匹配行处理
- Command
  - Ex命令：
    - p: 打印行
    - d：删除行
    - m [n]：移动行 
    - co [n]：复制行
    - y [name]：复制到寄存器
    - n pu [name]：从寄存器中粘贴
    - j：合并下一行
  - normal 命令
    ```
    :%g/^xyz/normal dd
    ```
  - 行内 global 命令 
    ```
    :g/pat/s//PAT/g
    ```

### 零宽度匹配

代码|功能
---|---
\@!|零宽度否匹配，亦即，要求前面的匹配原在当前位置_不_匹配。
\@<=|零宽度反向匹配。要求前面的匹配原紧贴在后面的模式之前匹配。
\@<!|零宽度反向否匹配，要求前面的匹配原**不**紧贴在其后的模式之前匹配。

## 常用正则代码


代码|功能
---|---
:g/^\(.*\)$\n\1$/d|删除连续相同的行，保留最后一行
:g/\%(^\1$\n\)\@<=\(.*\)$/d|删除连续相同的行，保留最开始一行
:g/^\s\*$\n\s\*$/d |删除连续多个空行，只保留一行空行
:g/^\s*$/d|删除所有空行
:g/str1/,/str2/d|删除所有第一个含str1到第一个含str2之间的行
:g/^$/,/./-j|压缩空行
:g/.\n\n\@!/normal o|批量加入空行
:%s/^/\=line('.').','/|添加行号
let i=0&#124;'<,'>g/0$/s//\=i/&#124;let i=i+1|变量输入序列

### 删除不相连重复行

- 删除重复行，结果不要求按原顺序
  ```
  :sort u
  ```
- 删除重复行，结果按照原顺序排列(这个有点麻烦)
  1. 为了保存原有顺序，首先给每行加上行号和1个{
  ```
  :let i=1|g/^/s//\=i.'{'/|let i+=1
  ```
  2. 按照行号后面的内容排序，参考:help :sort
  ```
  :sort /^\d\{-}{/ 
  ```
  3. 删除行号后面的内容相同的行
  保留后面的行`:g/^\d\{-}{\(.*\)$\n\d\{-}{\1$/d`
  或者保留开始的行`:g/\%(^\d\{-}{\1$\n\)\@<=\d\{-}{\(.*\)$/d`
  4. 按照行号恢复顺序
  ```
  :sort n
  ```
  5. 删除行首的原来的行号和{
  ```
  :%s/\d\{-}{//
  ```


### 字母大小写转换

原字符：`hello world`
正则表达式：`:s/\(.*\) \(.*\)/\U\1\e \2/`
转换结果：`HELLO world`

转换符|意义
---|---
\U|字符串大写
\u|首字符大写
\L|字符串小写
\l|首字母小写
\e|限制大小写转换范围

***
**本文相关**
1. 参考
[vim之删除重复行](http://www.blogdaren.com/post-1303.html)
[VIM - 黑衣教主](http://www.cnblogs.com/timdes/p/4753735.html)
